{% extends 'main/base.html' %}
{% block title %}User Detail - Admin{% endblock %}
{% block content %}
<div class="page-header"><div class="container"><h1><i class="fas fa-user"></i> {{ user_obj.username }}</h1></div></div>
<div class="container">
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card p-4">
                <h5 style="font-family:'Rajdhani',sans-serif;">User Info</h5>
                <p><strong>Username:</strong> {{ user_obj.username }}</p>
                <p><strong>Email:</strong> {{ user_obj.email|default:"—" }}</p>
                <p><strong>Joined:</strong> {{ user_obj.date_joined|date:"Y-m-d" }}</p>
                <p><strong>Last Login:</strong> {{ user_obj.last_login|date:"Y-m-d"|default:"Never" }}</p>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 style="font-family:'Rajdhani',sans-serif;">Test Drives ({{ test_drives.count }})</h5>
            <table class="table">
                <thead><tr><th>Car</th><th>Date</th><th>Status</th></tr></thead>
                <tbody>
                    {% for td in test_drives %}
                    <tr>
                        <td>{{ td.car.company.name }} {{ td.car.model }}</td>
                        <td>{{ td.date }}</td>
                        <td><span class="badge bg-{% if td.status == 'confirmed' %}success{% elif td.status == 'pending' %}warning{% else %}secondary{% endif %}">{{ td.get_status_display }}</span></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center text-muted">No test drives.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 style="font-family:'Rajdhani',sans-serif;">Loan Applications ({{ loans.count }})</h5>
            <table class="table">
                <thead><tr><th>Car</th><th>Amount</th><th>Status</th></tr></thead>
                <tbody>
                    {% for loan in loans %}
                    <tr>
                        <td>{{ loan.car.company.name }} {{ loan.car.model }}</td>
                        <td style="color:#e94560;font-weight:700;">${{ loan.amount }}</td>
                        <td><span class="badge bg-{% if loan.status == 'approved' %}success{% elif loan.status == 'pending' %}warning{% else %}danger{% endif %}">{{ loan.get_status_display }}</span></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center text-muted">No loans.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 style="font-family:'Rajdhani',sans-serif;">Car Purchases ({{ purchases.count }})</h5>
            <table class="table">
                <thead><tr><th>Car</th><th>Price</th><th>Payment</th><th>Date</th><th>Status</th></tr></thead>
                <tbody>
                    {% for p in purchases %}
                    <tr>
                        <td>{{ p.car.company.name }} {{ p.car.model }}</td>
                        <td style="color:#e94560;font-weight:700;">${{ p.total_price }}</td>
                        <td>{{ p.get_payment_method_display }}</td>
                        <td>{{ p.purchase_date|date:"Y-m-d" }}</td>
                        <td><span class="badge bg-{% if p.status == 'confirmed' %}success{% elif p.status == 'paid' %}warning{% else %}secondary{% endif %}">{{ p.get_status_display }}</span></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="text-center text-muted">No purchases.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 style="font-family:'Rajdhani',sans-serif;">Part Orders ({{ part_orders.count }})</h5>
            <table class="table">
                <thead><tr><th>Order ID</th><th>Amount</th><th>Payment</th><th>Date</th><th>Status</th></tr></thead>
                <tbody>
                    {% for order in part_orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td style="color:#e94560;font-weight:700;">${{ order.total_amount }}</td>
                        <td>{{ order.get_payment_method_display }}</td>
                        <td>{{ order.order_date|date:"Y-m-d" }}</td>
                        <td><span class="badge bg-{% if order.status == 'delivered' %}success{% elif order.status == 'shipped' %}info{% else %}warning{% endif %}">{{ order.get_status_display }}</span></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="text-center text-muted">No part orders.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <a href="{% url 'main:admin_user_list' %}" class="btn" style="background:#1a1a2e;color:white;border-radius:20px;">← Back to Users</a>
</div>
{% endblock %}